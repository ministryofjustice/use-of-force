{% extends "../partials/prisonerBannerLayout.njk" %}
{% from "../macros.njk" import submitLink %}
{% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{%- from "moj/components/alert/macro.njk" import mojAlert -%}

{% set showCancelEditButton = showCancelEditButton | default(true) %}
{% set showSaveAndReturnButton = showSaveAndReturnButton | default(true) %}
{% set saveButtonInEditModeText = saveButtonInEditModeText | default('Save') %}


{% block content %}

{% if errors.length > 0 %}
  {{ govukErrorSummary({
    titleText: "There is a problem",
    errorList: errors
  }) }}
{% endif %}

<div class="govuk-grid-row govuk-body">
    <div class="width-fit govuk-!-margin-left-4">
      {% if preventReportSubmission %}
        {{ mojAlert({
          variant: "information",
          dismissible: false,
          title: "You can not edit or submit this report. The incident date is over 13 weeks ago.",
          showTitleAsHeading: true,
          html: '<a href="/your-reports" class="govuk-link govuk-link--no-visited-state" data-qa="use-of-force-incidents-link-in-banner">Return to use of force incidents</a>'
        }) }}
      {% endif %}
    </div>
</div>

<form method="post">
  <input type="hidden" name="_csrf" value="{{ csrfToken }}" />

  {% block formItems %}

  {% endblock %}

  {% if coordinatorEditJourney %}

    {% if noChangeError == 'true' %}
      <p class="govuk-error-message">
        Cancel to return to the use of force incident page
      </p>
    {% endif %}

    <div class="flex-container">
    {{ govukButton({
      text: "Continue",
      name: "submitType",
      value: 'continue-coordinator-edit',
      attributes: {'data-qa': 'continue-coordinator-edit'}
    }) }}

    <a href="/{{data.reportId}}/view-incident" 
      class="govuk-link govuk-link--no-visited-state govuk-!-margin-left-3 govuk-!-margin-top-1 govuk-body-m" 
      id ="cancelCoordinatorEdit"
      data-qa="cancel-coordinator-edit">
      Cancel <span class="govuk-visually-hidden"> Cancel </span>
    </a>
  </div>
  {% else %}

  {% if preventReportSubmission %}
    <a href="/your-reports" class="govuk-link govuk-!-font-size-19">Return to Use of force incidents</a>

    {% elif editMode %}
      {{ govukButton({
        text: saveButtonInEditModeText,
        name: "submitType",
        value: 'save-and-continue',
        attributes: {'data-qa': 'save'}
      }) }}

      {% if showCancelEditButton %}

        {{ govukButton({
          text: "Cancel",
          name: "submitType",
          href: '/report/' + data.bookingId + '/check-your-answers',
          classes: "govuk-button govuk-button--secondary govuk-!-margin-left-3",
          attributes: {'data-qa': 'cancel'}
        }) }}
      {% endif %}
    {% else %}
      {{ govukButton({
        text: "Save and continue",
        name: "submitType",
        value: 'save-and-continue',
        attributes: {'data-qa': 'save-and-continue'}
      }) }}
      {% if showSaveAndReturnButton %}
        <br/>
        {{ 
          submitLink({
            label: 'Save and return to report use of force',
            qa: 'save-and-return', 
            value: 'save-and-return'
          }) 
        }}
      {% endif %}
    {% endif %}
  {% endif %}
  {% block additionalActions %}

  {% endblock %}
</form>

{% endblock %}
