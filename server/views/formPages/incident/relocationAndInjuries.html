{% extends "../formTemplate.html" %}
{% from "input/macro.njk" import govukInput %}
{% from "radios/macro.njk" import govukRadios %}
{% from "select/macro.njk" import govukSelect %}
{% from "checkboxes/macro.njk" import govukCheckboxes %}
{% import "../incidentMacros.njk" as incidentMacro %}
{% from "fieldset/macro.njk" import govukFieldset %} 
{% from "button/macro.njk" import govukButton %} 

{% block formItems %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h1 class="govuk-heading-xl mainHeading">Relocation and injuries</h1>


    <!-- Q1 -->

    {{ govukSelect({
        id: "prisoner-relocation",
        name: "prisonerRelocation",
        label: {
          text: "Where was the prisoner relocated to?"
        },
        attributes: {style:'min-width:33%'},
        items: [
          {
            value: "select",
            text: "Select",
            selected: true
          },
          {
            value: "ownCell",
            text: "Own cell"   
          },
          {
            value: "segregationUnit",
            text: "Segregation unit"
          },
          {
            value: "specialAccommodation",
            text: "Special accommodation"
          },
          {
            value: "cellularVehicle",
            text: "Cellular vehicle"
          }
        ]
      }) }}

    <!-- Q2 -->

    {{ govukSelect({
      id: "relocation-compliancy",
      name: "prisonerCompliancy",
      classes:" govuk-!-margin-bottom-6",
      label: {
        text: "What type of relocation was it?"
      },
      attributes: {style:'min-width:33%'},
      items: [
        {
          value: "select",
          text: "Select",
          selected: true
        },
        {
          value: "compliant",
          text: "compliant"
        },
        {
          value: "nonCompliant",
          text: "Non-compliant"
        }
      ]
    }) }}

    <hr />
  </div>

  <div class="govuk-grid-column-two-thirds">

    <!-- Q3 -->

    <h2 class="govuk-heading-l govuk-!-margin-top-6">Injuries sustained and healthcare involvement</h2>

    {{ incidentMacro.radiosWithNestedTextboxes({
        "primaryQuestion": {
          "text": "Was a member of Healthcare present throughout the incident (doctor, registered nurse or healthcare officer)?",
          "name": "healthcareInvolved",
          "options": [{
            "value": "yes",
            "label": "Yes"
          }, 
          {
            "value": "no",
            "label": "No"
          }]
        },
        "followUpQuestion": {
          "legend": "blank",
          "name": "healthcarePractionerName",
          "alertMsg":"",
          "options": [{
            "label": "Name"
          }]
        }
      }) 
    }}

        <!-- Q4 -->


        {{ incidentMacro.radiosWithNestedTextboxes({
            "primaryQuestion": {
              "text": "Did the prisoner sustain any injuries at the time?",
              "name": "prisonerInjuries",
              "options": [{
                "value": "yes",
                "label": "Yes"
              }, 
              {
                "value": "no",
                "label": "No"
              }]
            },
            "followUpQuestion": {
              "legend": "Who completed the F213 form?",
              "name": "f213CompletedBy",
              "alertMsg": "An F213 must be completed on all prisoners, even if they appear not to have sustained any injuries",
              "options": [{
                "label": "Name"
              }]
            }
          }) 
        }}
    


    <!-- Q5 -->
    <div class="govuk-!-margin-bottom-9">
      {{ govukRadios({
          classes: "govuk-radios--inline",
          idPrefix: "prisoner-hospitalisation",
          name: "prisonerHospitalisation",
          fieldset: {
            legend: {
              text: "Did the prisoner require outside hospitalisation at the time?",
              isPageHeading: false,
              classes: "govuk-fieldset"
            }
          },
          items: [
            {
              value: "yes",
              text: "Yes"
            },
            {
              value: "no",
              text: "No"
            }
          ]
        }) 
        }}
      </div>

<!-- Q6 -->

<div class="govuk-!-margin-bottom-6">
      <div class="govuk-fieldset">
        <legend class="govuk-fieldset__legend ">
          Did a member of staff need medical attention at the time?
        </legend>

        <div class="govuk-radios" data-module="radios">
          <div class=" govuk-radios--inline">
            <div class="govuk-radios__item">
              <input class="govuk-radios__input" id="how-contacted-conditional-1" name="how-contacted" type="radio"
                value="yes" data-aria-controls="conditional-how-contacted-conditional-1">
              <label class="govuk-label govuk-radios__label" for="how-contacted-conditional-1">
                Yes
              </label>
            </div>
            <div class="govuk-radios__item">
              <input class="govuk-radios__input" id="how-contacted-conditional-1" name="how-contacted" type="radio"
                value="no">
              <label class="govuk-label govuk-radios__label" for="how-contacted-conditional-1">
                No
              </label>
            </div>
          </div>

          <!-- hidden panel start -->
          <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="conditional-how-contacted-conditional-1">

            <!-- add another starts here   -->
          
            <div class="add-another-witness">
              {% for staffMember in data.witnesses %} 
                {% call govukFieldset({ classes: 'add-another__item' }) %}
                  {{
                    govukInput({
                      label: {
                        html: 'Name'
                      },
                      classes: 'govuk-!-width-one-third',
                      id: 'witnesses[' + loop.index0 + '][name]',
                      name: 'witnesses[' + loop.index0 + '][name]',
                      value: staffMember.name,
                      attributes: {
                        'data-name': 'witnesses[%index%][name]',
                        'data-id': 'witnesses[%index%][name]'
                      }
                    })
                  }}
                <button type="button" class="govuk-button govuk-button--secondary add-another__remove-button">
                  Remove
                </button>
                {% endcall %} 
                {% else %} 
                {% call govukFieldset({ classes: 'add-another__item' }) %}
                  
                  {{
                    govukInput({
                      label: {
                        html: 'Name of who needed medical attention'
                      },
                      classes: 'govuk-!-width-one-third',
                      id: 'witnesses[0][name]',
                      name: 'witnesses[0][name]',
                      attributes: {
                        'data-name': 'witnesses[%index%][name]',
                        'data-id': 'witnesses[%index%][name]'
                      }
                    })
                  }}

                  {{ govukRadios({
                    classes: "govuk-radios--inline",
                    idPrefix: "changed-name",
                    name: "changed-name",
                    fieldset: {
                      legend: {
                        text: "Did they go to hospital?"
                      }
                    },
    
                    items: [
                      {
                        value: "yes",
                        text: "Yes"
                      },
                      {
                        value: "no",
                        text: "No"
                      }
                    ]
                  }) }}

                {% endcall %} 
              {% endfor %}
              <div class="button-action">
                {{
                  govukButton({
                    text: 'Add another witness',
                    classes: 'govuk-button--secondary  add-another__add-button govuk-!-margin-bottom-4',
                    attributes: { 'data-qa-add-another-witness': true }
                  })
                }}
              </div> 
            </div>  <!-- add another ends here -->
          </div>  <!-- hidden panel end -->
        </fieldset>     
      </div> <!-- end of this component  -->


  </div> <!-- end of column two thirds -->
</div>   <!-- end of grid row-->


<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/add-another.js"></script>
<script>
new AddAnother($('.add-another-staff-member'))
new AddAnother($('.add-another-witness'))
</script>


{% endblock %}
